
# سؤال 0

بعد از مطالعه [آداب‌نامه انجام تمرین‌های درسی](https://docs.ce.sharif.edu/rules/ethics)، علت نقض یا عدم نقض آداب‌نامه را در هر یک موارد زیر **به طور مختصر** بیان کنید.

1. الیاس و بابک برای حل یک سؤال با هم مشورت کرده و به یک پاسخ مشترک رسیده‌اند. آن‌ها این پاسخ را ارسال می‌کنند و مشورت خود را نیز در آن اعلام می‌کنند.
1. کیانا پاسخ خود به سؤالات تمرین را در گروهی با دیگران به اشتراک می‌گذارد و تأکید می‌کند از آن کپی نشود و تنها برای چک کردن و ایده کلی استفاده شود.
1. هوشنگ، ناراحت از اینکه پاسخ یک سؤال در اسلایدهای درس نیست، آن را از یک چت‌بات می‌پرسد و بعد از اینکه جواب را به طور کامل متوجه شد، پاسخ خود را مشابه آن می‌نویسد، بدون اینکه عیناً آن را کپی کرده باشد.
1. مانا و مونا در مورد تمرین درس با هم صحبت می‌کنند و مونا رویکرد خود برای حل یک سؤال را توضیح می‌دهد. مانا با الهام گرفتن از ایده مونا، به طور مستقل پاسخ خود را می‌نویسد و همفکری خود با مونا را نیز ذکر می‌کند.

----------

# سؤال 1

فرض کنید
$h:\{0,1\}^*\rightarrow \{0,1\}^n$
یک تابع چکیده‌ساز برخوردتاب(Collision-resistant) دلخواه است. در هر یک از موارد زیر، برخوردتاب بودن $g$ را بررسی و ادعای خود را اثبات کنید.
> راهنمایی: برای اثبات برخوردتاب بودن، از برهان خلف و برای اثبات برخوردتاب نبودن، از مثال نقض استفاده کنید.
1. $g(x)=h(x) \oplus h(\bar{x})$

	$\bar{x}:$ مکمل دودویی
1. $g(x_1\dots x_m)=x_1 \| h(x_2\dots x_m)$

	$x_i\in \{0,1\}, m \ge 2$
1. $g(x_1\dots x_{2m})=h((x_1\dots x_m) \oplus (x_{m+1}\dots x_{2m}))$

	$x_i\in \{0,1\}, m \ge 1$
1. $g(x)=h(0\| x) \oplus h(1 \| x)$
1. $g(x)=h(h(x))$

----------
# سؤال 2

برای امضای تراکنش در بیتکوین از الگوریتم ECDSA استفاده می‌شود. توضیح این الگوریتم را می‌توانید در [این لینک](https://en.bitcoin.it/wiki/Elliptic_Curve_Digital_Signature_Algorithm) مطالعه کنید.

1. اگر $(r,s)$ یک امضای معتبر باشد، نشان دهید $(r,-s)$ هم معتبر است.
1. توضیح دهید اگر از مقدار یکسان $k$ برای امضای دو پیام متفاوت استفاده شود، چگونه می‌توان کلید خصوصی را از این دو امضاء استخراج کرد.
> راهنمایی: اختلاف مقدار $s$ از دو امضاء را محاسبه کنید.
1. اگر پیام امضاشده را با $m$ نشان دهیم، طبق تعریف اصلی الگوریتم، مقدار $s$ در امضاء به صورت زیر محاسبه می‌شود:
$$s=k^{-1}(\textrm{dSHA256}(m)+r\times d_A) \mod n$$
حال فرض کنید $m$ را یک عدد در نظر  گرفته و الگوریتم را به صورت زیر تغییر دهیم:
$$s=k^{-1}(m+r\times d_A)\mod n$$
نشان دهید در این نسخه تغییر یافته، بدون داشتن کلید خصوصی $d_A$، می‌توان امضای معتبر برای یک پیام ساخت.
> راهنمایی: فرض کنید برای $\alpha$ دلخواه داریم: $k=d_A+\alpha$؛ سپس مقدار $m$ را طوری انتخاب کنید که $r,s$ معتبر بدون دانستن $d_A$ قابل تعیین باشند.

----------
# سؤال 3
جدول زیر ویژگی‌های 3 نمایش متفاوت پول را با هم مقایسه می‌کند. ثابت یا متغیر بودن هر ویژگی در طی انجام تراکنش تعیین می‌شود.

| نمایش پول | شناسه | ارزش | صاحب |
|:---:|:---:|:---:|:---:|
| UTxO | متغیر | دلخواه | متغیر |
| اسکناس | ثابت | ثابت | متغیر |
| حساب بانکی | ثابت | دلخواه | ثابت |

این سه روش را بر اساس هر یک معیارهای آورده شده در ادامه با هم مقایسه کنید. برای هر مقایسه، توجیه خود را ارائه دهید.

1. حجم ذخیره‌سازی سمت کاربر و سرور
1. امکان انجام تراکنش همزمان
1. سربار هماهنگی انجام تراکنش در محیط توزیع شده(پول‌ها در سرورهای متفاوت مدیریت شوند)
1. حریم خصوصی کاربران(امکان پیوند و ردگیری تراکنش‌ها)

----------

# سؤال 4

با مراجعه به [کد منبع آخرین نسخه کلاینت بیتکوین](https://github.com/bitcoin/bitcoin/blob/master/src/kernel/chainparams.cpp#L137)، به سؤالات زیر پاسخ دهید.
1. پاسخ‌های یکی از DNS Seed ها به درخواست‌های مکرر را بررسی کنید. آیا آدرس‌های برگردانده شده یکسان و متناسب با موقعیت جغرافیایی هستند؟ این رفتار را با عملکرد متداول DNS ها مقایسه و توجیه کنید.
1. فرض کنید یک مهاجم  با انجام حمله مرد میانی، تمام پاسخ‌های DNS Seed ها را طوری تغییر دهد که تنها گره‌های تحت کنترل مهاجم به عنوان پاسخ برگردانده شوند. گره‌های تحت کنترل مهاجم طوری وانمود می‌کنند که طول زنجیره بلوکی بسیار کوتاه‌تر از اندازه واقعی آن است؛ بدین ترتیب یک نسخه کوچک از شبکه بیتکوین ایجاد می‌شود. با این نوع حملات چطور مقابله شده است؟
1. شرایط مشابه قسمت قبل را در نظر بگیرید، با این تفاوت که مهاجم قصد تغییر در زنجیره بیتکوین را ندارد و تنها قصد شناسایی و نقض حریم خصوصی افراد را داشته باشد. آیا استفاده از الگوریتم Perigee در این شرایط کمک می‌کند؟ الگوریتم Dandelion چطور؟


----------

# سؤال 5

با استفاده کاوشگر [BTC mempool](https://btcmempool.org/) به سؤالات زیر پاسخ دهید.

1. حداقل چند استخر استخراج باید همکاری کنند تا حمله %51 انجام شود؟
1. با مشاهده نمودار میزان سختی و قدرت پردزشی شبکه در یک سال گذشته، ارتباط میان این دو را به طور مختصر توضیح دهید.
1. با توجه به میزان سختی بلوک 883008، حداقل تعداد صفر ابتدایی مورد انتظار در نمایش دودویی چکیده بلوک را بدست آورید و با مقدار چکیده مقایسه کنید. آیا اختلاف موجود نشان دهنده اتلاف قدرت پردازشی است؟
1. متوسط قدرت پردازشی شبکه را در بازه زمانی بین دو بلوک 883008 و 885023 تخمین بزنید.
>راهنمایی: میزان سختی در این بازه زمانی ثابت است و با در نظر گرفتن تعداد بلوک استخراج شده، می‌توان قدرت شبکه را تخمین زد.
1. باتوجه به اینکه میزان سختی طوری تنظیم می‌شود که به طور میانگین هر بلوک در 600 ثانیه تولید شود، سختی بلوک 885024 را از طریق محاسبه به دست آورید و با مقدار ثبت شده در کاوشگر مقایسه کنید.
>راهنمایی: از نسبت زمان مورد انتظار برای تولید یک بلوک به متوسط زمان صرف شده برای تولید هر بلوک در بازه بین دو بلوک اشاره شده در بخش قبل استفاده کنید. 
1. اگر سختی را طوری تعیین کنیم که به طور میانگین هر ثانیه یک بلوک تولید شود، چه مشکلی ممکن است پیش بیاید؟ آیا این کار مزیتی هم دارد؟

----------

# سؤال 6
با استفاده از [مستندات بیتکوین](https://en.bitcoin.it/wiki/Script) به سؤالات زیر پاسخ دهید.

1. گواه(Witness) معتبری برای اسکریپت زیر ارائه دهید. برای خوانایی بهتر، اسکریپت در چند خط نوشته شده است.
```
OP_TUCK OP_OVER
OP_DUP OP_ADD OP_SWAP OP_SUB OP_15 OP_EQUALVERIFY
OP_SUB OP_5 OP_EQUAL
```

1. اسکریپت معادل برای امضای چندگانه زیر، بدون استفاده از دستور `OP_CHECKMULTISIG` بنویسید؛ سپس با فرض داشتن امضای معتبر برای کلیدهای `pk1` و `pk3`، گواه معتبری برای هر دو اسکریپت اصلی و معادل ارائه کنید.
> راهنمایی: از `OP_ROT` و `OP_ADD`و `OP_SWAP` استفاده کنید.
```
OP_2 <pk4> <pk3> <pk2> <pk1> OP_4 OP_CHECKMULTISIG
```

1. یک مادربزرگ می‌خواهد به نوه‌اش بیتکوین بدهد؛ امّا می‌خواهد تا قبل از 18 سالگی، نوه‌اش نتواند آن را خرج کند. برای این کار دو روش وجود دارد:
	- تراکنش انتقال بیتکوین به نوه با قفل زمانی(timelock) امضاء شده و به او داده شود.
	- بیتکوین‌های هدیه به یک UTxO منتقل شوند که فقط بعد از روز تولد 18 سالگی و فقط توسط نوه قابل خرج کردن باشد.

 روش اوّل مناسب نیست و از آن استفاده نمی‌شود. حداقل دو ضعف این روش را بیان کنید. سپس اسکریپت قفل کننده UTxO مقصد در روش دوم را با فرض اینکه تولد 18 سالگی نوه روز 1 ژانویه 2026 است، بنویسید و گواه معتبری نیز برای آن ارائه دهید.

----------

# سؤال 7
نوع چکیده امضاء(Signature Hash Type) برای مشخص کردن بخش‌های امضاشده در یک تراکنش استفاده می‌شود. می‌توانید در [این لینک](https://wiki.bitcoinsv.io/index.php/SIGHASH_flags) در مورد آن مطالعه کنید. در هر یک از شرایط زیر، راهکاری با استفاده از نوع چکیده امضای مناسب پیشنهاد دهید و انتخاب خود را توجیه کنید.

1. نوه مادربزرگِ سؤال قبل نگران است تا زمانی که 18 ساله شود ممکن است کلید خصوصی کیف پول خود را گم کرده و هدیه از دست برود؛ در نتیجه تصمیم می‌گیرد یک کیف پول حضانتی مبتنی بر خدمات ابری گرفته و با استفاده از یک تراکنش، هدیه را به کیف پول جدید خود انتقال دهد. این تراکنش در حال حاضر به دلیل قفل زمانی، در شبکه پذیرفته نمی‌‎شود ولی نوه حاضر است در ازای پرداخت مقدار مشخصی از هدیه خود، این تراکنش توسط سایرین نگهداری و بعد از 18 سالگی‌اش ثبت شود. این کار چگونه قابل انجام است؟
1. مغازه‌داری از یک کیف پول گرم برای نگهداری درآمدهای روزانه و از یک کیف پول سخت‌افزاری سرد برای پس‌انداز استفاده می‌کند. او تصمیم به خرید ماشین می‌گیرد، امّا نمی‌خواهد کیف پول سرد را از محل نگهداری آن خارج کند. همچنین با توجه به اینکه ممکن است جست‌وجو برای ماشین و خرید آن چند روز طول بکشد، نمی‌خواهد مقدار زیادی بیتکوین در کیف پول گرم خود نگهداری کند؛ در نتیجه او می‌خواهد تا زمان قطعی شدن معامله، بیتکوین در کیف پول سرد باقی بماند. دقت کنید مغازه‌دار، قیمت ماشین و آدرس فروشنده را از قبل **نمی‌داند**. این مغازه‌دار محتاط چطور ماشین بخرد؟
1. اگر مغازه‌دار بخش قبل، قیمت دقیق ماشین را از قبل **بداند** امّا آدرس فروشنده را فقط پای معامله بفهمد، چگونه می‌تواند نسبت به بخش قبل بهتر عمل کند؟
